const d=(e,t,r)=>{var o=e.createShader(t);if(e.shaderSource(o,r),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS))return o;throw new Error(`Erro ao compilar shader (${t}): `+e.getShaderInfoLog(o))},g=(t,r,...e)=>{if(e.forEach(e=>t.attachShader(r,e)),t.linkProgram(r),!t.getProgramParameter(r,t.LINK_STATUS))throw new Error("ERROR linking program!"+t.getProgramInfoLog(r));if(t.validateProgram(r),t.getProgramParameter(r,t.VALIDATE_STATUS))return r;throw new Error("ERROR validating program!"+t.getprogramInfoLog(r))};const r=["initial","star","flower","noise"];if((async()=>{var e=r.map(e=>`<option value="${e}">${e}</option>`).join(" "),t=document.getElementById("cList");console.log(e),t.innerHTML=e,t.addEventListener("change",function(e){var t=this.options[this.selectedIndex];c(t.value)})})(),location.origin.includes("10001")){const l=new WebSocket("ws://localhost:10001/watch");l.onmessage=e=>{console.log("asdfasdf"),t(canvas_title.innerHTML)},l.onopen=e=>{(s=async e=>{try{return await l.send(e),!0}catch(e){return console.error(e),!1}})(canvas_title.innerHTML)}}const o=document.getElementById("cContainer"),a=document.getElementById("cText"),n=((e,t,r)=>{const a=document.getElementById(e),n=(e=>{if(!e)throw new Error("Canvas não encontrado");e.style.display="block";e=e.getContext("webgl")||e.getContext("experimental-webgl");if(e)return e;throw new Error("webGL não suportado")})(a);a.width=r*a.clientWidth,a.height=r*a.clientHeight,n.viewport(0,0,a.width,a.height);e=d(n,n.VERTEX_SHADER,` precision mediump float; attribute vec4 vertPosition; varying vec2 Position; void main() { Position = vertPosition.xy; gl_Position = vertPosition; }`),t=t?d(n,n.FRAGMENT_SHADER,t):null;const o=g(n,n.createProgram(),e,t);n.useProgram(o);e=n,t=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,t);n.bufferData(n.ARRAY_BUFFER,new Float32Array([1,1,-1,1,-1,-1,1,-1]),n.STATIC_DRAW);e=n.getAttribLocation(o,"vertPosition");n.vertexAttribPointer(e,2,n.FLOAT,n.FALSE,2*Float32Array.BYTES_PER_ELEMENT,0),n.enableVertexAttribArray(e);const i=(new Date).getTime(),s=[0,0];var c,l;return{draw:(e=i)=>{var t=n.getUniformLocation(o,"Resolution"),t=(n.uniform2fv(t,[a.width,a.height]),n.getUniformLocation(o,"Time")),t=(n.uniform1f(t,i-e),n.getUniformLocation(o,"Mouse"));n.uniform2fv(t,s),n.drawArrays(n.TRIANGLE_FAN,0,4)},destroy:()=>{return e=n,t=a,r=t.id,(o=t.parentNode).removeChild(t),(t=document.createElement("canvas")).style.display="none",t.id=r,o.prepend(t),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteProgram(program),e.deleteShader(fragmentShader),e.deleteShader(vertexShader),e.deleteBuffer(vertexBufferObject),void(e.canvas.width=e.canvas.height=1);var e,t,r,o},update:(c=n,l=o,e=>{var e=d(c,c.FRAGMENT_SHADER,e),[t,r]=c.getAttachedShaders(l);c.detachShader(l,r),l=g(c,l,e,t),c.useProgram(l)}),mouse:s,resScale:r,canvas:a,gl:n}})("c",` precision mediump float; uniform float Time; uniform vec2 Resolution; uniform vec2 Mouse; varying vec2 Position; void main() { gl_FragColor = vec4(.0); }`,2);window.setInterval(()=>n.draw((new Date).getTime()),1e3/24),n.canvas.addEventListener("mousemove",e=>{n.mouse[0]=2*n.resScale*e.offsetX/n.canvas.width-1,n.mouse[1]=2*(n.canvas.height-n.resScale*e.offsetY)/n.canvas.height-1});let i=null;const t=async e=>{try{o.style.display="none";var t=await(await fetch(`fragments/${e}.frag`)).text();return n.update(t),e!==i&&(i=e,a.innerHTML=t,console.log("Shader alterado para "+e)),o.style.display="block",!0}catch(e){return console.error(e),!1}};let s=()=>!1;const c=async e=>await t(e)&&await s(e);c("initial");