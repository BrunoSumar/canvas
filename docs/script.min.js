const l=(e,r,t)=>{var o=e.createShader(r);if(e.shaderSource(o,t),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS))return o;throw new Error(`Erro ao compilar shader (${r}): `+e.getShaderInfoLog(o))},g=(r,t,...e)=>{if(e.forEach(e=>r.attachShader(t,e)),r.linkProgram(t),!r.getProgramParameter(t,r.LINK_STATUS))throw new Error("ERROR linking program!"+r.getProgramInfoLog(t));if(r.validateProgram(t),r.getProgramParameter(t,r.VALIDATE_STATUS))return t;throw new Error("ERROR validating program!"+r.getprogramInfoLog(t))};const t=["initial","star","flower"];if((async()=>{var e=t.map(e=>`<option value="${e}">${e}</option>`).join(" "),r=document.getElementById("cList");console.log(e),r.innerHTML=e,r.addEventListener("change",function(e){var r=this.options[this.selectedIndex];c(r.value)})})(),location.origin.includes("10001")){const d=new WebSocket("ws://localhost:10001/watch");d.onmessage=e=>{console.log("asdfasdf"),r(n.innerHTML)},d.onopen=e=>{(s=async e=>{try{return await d.send(e),!0}catch(e){return console.error(e),!1}})(n.innerHTML)}}const o=document.getElementById("cContainer"),n=document.getElementById("cTitle"),a=document.getElementById("cText"),i=((e,r,t)=>{const n=document.getElementById(e),a=(e=>{if(!e)throw new Error("Canvas não encontrado");e.style.display="block";e=e.getContext("webgl")||e.getContext("experimental-webgl");if(e)return e;throw new Error("webGL não suportado")})(n);n.width=t*n.clientWidth,n.height=t*n.clientHeight,a.viewport(0,0,n.width,n.height);e=l(a,a.VERTEX_SHADER,` precision mediump float; attribute vec4 vertPosition; varying vec2 Position; void main() { Position = vertPosition.xy; gl_Position = vertPosition; }`),r=r?l(a,a.FRAGMENT_SHADER,r):null;const o=g(a,a.createProgram(),e,r);a.useProgram(o);e=a,r=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,r);a.bufferData(a.ARRAY_BUFFER,new Float32Array([1,1,-1,1,-1,-1,1,-1]),a.STATIC_DRAW);e=a.getAttribLocation(o,"vertPosition");a.vertexAttribPointer(e,2,a.FLOAT,a.FALSE,2*Float32Array.BYTES_PER_ELEMENT,0),a.enableVertexAttribArray(e);const i=(new Date).getTime(),s=[0,0];var c,d;return{draw:(e=i)=>{var r=a.getUniformLocation(o,"Resolution"),r=(a.uniform2fv(r,[n.width,n.height]),a.getUniformLocation(o,"Time")),r=(a.uniform1f(r,i-e),a.getUniformLocation(o,"Mouse"));a.uniform2fv(r,s),a.drawArrays(a.TRIANGLE_FAN,0,4)},destroy:()=>{return e=a,r=n,t=r.id,(o=r.parentNode).removeChild(r),(r=document.createElement("canvas")).style.display="none",r.id=t,o.prepend(r),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteProgram(program),e.deleteShader(fragmentShader),e.deleteShader(vertexShader),e.deleteBuffer(vertexBufferObject),void(e.canvas.width=e.canvas.height=1);var e,r,t,o},update:(c=a,d=o,e=>{var e=l(c,c.FRAGMENT_SHADER,e),[r,t]=c.getAttachedShaders(d);c.detachShader(d,t),d=g(c,d,e,r),c.useProgram(d)}),mouse:s,resScale:t,canvas:n,gl:a}})("c",` precision mediump float; uniform float Time; uniform vec2 Resolution; uniform vec2 Mouse; varying vec2 Position; void main() { gl_FragColor = vec4(.0); }`,2);window.setInterval(()=>i.draw((new Date).getTime()),1e3/24),i.canvas.addEventListener("mousemove",e=>{i.mouse[0]=2*i.resScale*e.offsetX/i.canvas.width-1,i.mouse[1]=2*(i.canvas.height-i.resScale*e.offsetY)/i.canvas.height-1});const r=async e=>{try{o.style.display="none";var r=await(await fetch(`fragments/${e}.frag`)).text();return i.update(r),e!==n.innerHTML&&(n.innerHTML=e,a.innerHTML=r,console.log("Shader alterado para "+e)),o.style.display="block",!0}catch(e){return console.error(e),!1}};let s=()=>!1;const c=async e=>await r(e)&&await s(e);c("initial");